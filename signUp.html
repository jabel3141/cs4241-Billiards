<html>

	<head>
		<title>CSC Billiard Analytics - Sign Up</title>
		<link rel="shortcut icon" type="image/x-icon" href="img/home/favicon.ico" />
		<link rel="shortcut icon" type="image/x-icon" href="img/home/favicon.ico" />
	  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	  	
	  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	  	<link href="https://fonts.googleapis.com/css?family=Arvo" rel="stylesheet">
	 	<link href="https://fonts.googleapis.com/css?family=Verdana" rel="stylesheet">
	  	<link id="css" rel="stylesheet" type="text/css" href="style.css"/>

  		<style>
  			.btn {
  				width: 100%;
  			}

  			#form-box {
  				padding-bottom: 20px;
  			}


  		</style>


	</head>

	<body>
		
		<nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html"><span class="active">Billiard Analytics </span> <span class="sr-only">Current</span></a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
          <ul class="nav navbar-nav">
            <li><a href="examFundamentals.html">Exam I </a></li>
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown">Exam II <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="examSkills.html">Bachelors</a></li>
                <li><a href="examSkillsM.html">Masters</a></li>
                <li><a href="examSkillsD.html">Doctorate</a></li>
              </ul>
            </li>
            <li><a href="searchProfile.html">Profiles</a></li>
            
          </ul>
          <ul class="nav navbar-nav navbar-left">

          </ul>
          <ul class="nav navbar-nav navbar-right">
          	<li><a href="signUp.html">Sign Up</a></li>
          	<li><a href="projectTeam.html">Project Team</a></li>
            <li><a href="xtreme.html">X-Treme App</a></li>
            <li><a href="http://billiarduniversity.org/exams.html" target="_blank">BU Site</a></li>

          </ul>
        </div>
      </div>
    </nav>

    <div class="main">
    	<div class="row">
        	<div id="top-text" class="col-sm-12">
        		<center><h2><b>CSC Billiard Analytics Sign Up</b></h2></center>
        	</div>
        </div>

        <div id="finished" class="row">
        	<div class="col-sm-5">
        	
        	</div>
        	<div id="form-box" class="col-sm-4">
        		<div class="row">
	        		<div class="col-sm-6">
		        		<p>Username (no spaces):
		        		<input id="username-field" type="text" maxlength="18" name="pinNum" class="form-control" placeholder="(Max: 18 characters)" onkeyup="checkForm()"/></p>
		        	</div>
		        	<div class="col-sm-6">
		        		<p><span id="userMatchAlert"></span><span id="spaceAlert"></span></p>
		        	</div>
	        	</div>
	        	<div class="row">
		        	<div class="col-sm-6">
		        		<p>4-digit Pin:
		        		<input id="pin-field" type="password" maxlength="4" name="pinNum" class="form-control" placeholder="Pin" onkeyup="checkForm()"/></p>
		        	</div>
		        </div>
		        <div class="row">
		        	<div class="col-sm-6">
		        		<p>Confirm 4-digit Pin:
		        		<input id="pinConfirm-field" type="password" maxlength="4" name="pinNumConfirm" class="form-control" placeholder="Re-Type Pin" onkeyup="checkForm()"/></p>
		        	</div>
		        	<div class="col-sm-6">
		        		<p><span id="pinMatchAlert"></span></p>
		        	</div>
		        </div>	
		        
	        	<div class="row">
		        	<div class="col-sm-6">
	        			<button id="submitBtn" type="button" class="btn btn-success" onclick="register()" disabled>Submit Form</button>
	        		</div>
	        	</div>


	        	
        	</div>
        	<div class="col-sm-4">
        	
        	</div>
        </div>

        

		<div id="alertModal" class="modal fade" role="dialog">
	        <div class="modal-dialog">

	          <!-- Modal content-->
	          <div class="modal-content">
	            <div class="modal-header">
	              <button type="button" class="close" data-dismiss="modal">&times;</button>
	              <h4 class="modal-title">Which exam would you like to take?</h4>
	            </div>
	            <div class="modal-body">
	              <p>It is recommended that you have someone else record your scores.</p>
	            </div>
	            <div class="modal-footer">
	              <div class="row">
	                <div class="col-sm-5">
	                  <button type="button" class="btn btn-primary modButton" id="button-full" data-dismiss="modal" onclick="exam1()">Exam I (Fundamentals)</button>
	                </div>
	              </div>
	              <br>
	              <div class="row">
	                <div class="col-sm-4">
	                  <button type="button" class="btn btn-success modButton" data-dismiss="modal" onclick="exam2()">Exam II (Bachelors)</button>
	                </div>
	                <div class="col-sm-4">
	                  <button type="button" class="btn btn-success modButton" data-dismiss="modal" onclick="exam3()">Exam II (Masters)</button>
	                </div>
	                <div class="col-sm-4">
	                  <button type="button" class="btn btn-success modButton" data-dismiss="modal" onclick="exam4()">Exam II (Doctorate)</button>
	                </div>
	              </div>
	            </div>
	          </div>

	        </div>
	      </div>

	  <footer>
        <div class="row" id="foot">
          <div class="col-sm-3">
            <h4><p>Powered by Heroku</p></h4>
          </div>

          <div class="col-sm-3">
            <h4>
              <p><a href="index.html">About the Site</a></p>
              <p><a href="signUp.html">Create an Account</a></p>
              <p><a href="faq.html">FAQ</a></p>
            </h4>
          </div>

          <div class="col-sm-3">
            <h4>
              <p><a href="projectTeam.html">Project Team</a></p>
              <p><a href="http://billiarduniversity.org/">Billiard University Site</a></p>
            </h4>
          </div>

          <div class="col-sm-3">
            <p>
              <h4>Contact Us:<br/>
              <i>cscbilliardanalytics@gmail.com</i></h4>
            </p>

            <p>
              Approved by Dr. Dave Alciatore<br/>Billiard University<br/> [December 2017]
            </p>
          </div>
        </div>

      </footer>

    </div>



	</body>

	<script>
		var user = ""
		var pin = ""
		var confPin = ""
		var userExists = false
		var existingUsers = []

		getUserList()

		function checkForm(){
			user = document.getElementById('username-field').value
			pin = document.getElementById('pin-field').value
			confPin = document.getElementById('pinConfirm-field').value

			checkUsername()

			if(!userExists && user != "" && pin == confPin && pin.length == 4 && !user.includes(" ") && !user.includes("<") && !user.includes(">") && !user.includes("/") && !user.includes("%") && !user.includes("#") && !user.includes("&") && !user.includes("?") && !user.includes(",") && !user.includes("(") && !user.includes(")")){
				document.getElementById('submitBtn').disabled = false
			}
			else{
				document.getElementById('submitBtn').disabled = true
			}

			if(user.includes(" ") || user.includes("<") || user.includes(">") || user.includes("/") || user.includes("%") || user.includes("#") || user.includes("&") || user.includes("?") || user.includes(",") || user.includes("(") || user.includes(")")){
				document.getElementById('spaceAlert').innerHTML = '<div class="alert alert-danger"><strong>Error!</strong> No spaces or <>/%#&?,().</div>'
			}
			else{
				document.getElementById('spaceAlert').innerHTML = ""
			}

			if(confPin.length == 4 && pin != confPin){
				document.getElementById('pinMatchAlert').innerHTML = '<div class="alert alert-danger"><strong>Error!</strong> Pin does not match!</div>'
			}
			else{
				document.getElementById('pinMatchAlert').innerHTML = ""
			}
		}

		// function getUsername(){
	 //      function reqListener () {
	 //      	console.log("getting username")
	 //        var u = JSON.parse(this.responseText)
	 //        console.log( u )
	 //        userExists = u[0].username

	 //        setTimeout(function(){
		//         if(userExists == true){
		//         	document.getElementById('userMatchAlert').innerHTML = '<div class="alert alert-danger"><strong>Error!</strong> Username is already taken!</div>'
		//         }
		//         else{
		//         	document.getElementById('userMatchAlert').innerHTML = ""
		//         }
		//     }, 1000)
	        
	 //      }
	      
	 //      var oReq = new XMLHttpRequest();
	      
	 //      oReq.addEventListener("load", reqListener);
	 //      oReq.open("GET", "/getUsername");
	 //      oReq.send();
	 //    }

	    function checkUsername(){
	        for(i = 0; i < existingUsers.length; i++){
		      	if(existingUsers[i].username.toLowerCase() == user.toLowerCase()){
		      		userExists = true
		      		document.getElementById('userMatchAlert').innerHTML = '<div class="alert alert-danger"><strong>Error!</strong> Username is already taken!</div>'
		      		
		      		break
		      	}
		      	else{
		      		userExists = false
		      		document.getElementById('userMatchAlert').innerHTML = ""
		      	}
	        }
	        

	      	
	      
	     //  function reqListener () {
	     //  	setTimeout(function(){
		    //     getUsername();
		    // }, 1000)
	        
	     //  }
	      
	     //  var oReq = new XMLHttpRequest();
	      
	     //  console.log("username check")
	     //  console.log(user)
	     //  oReq.addEventListener("load", reqListener);
	     //  oReq.open("POST", "/setCheckUsername", true);
	     //  oReq.send('username='+user);

	    }

	    function getUserList() {

	      function reqListener () {
	        var loadUsers = JSON.parse(this.responseText)
	        console.log( loadUsers )
	        existingUsers = loadUsers
	      }

	      var oReq = new XMLHttpRequest();

	      oReq.addEventListener("load", reqListener);
	      oReq.open("GET", "/getUserList");
	      oReq.send();
	    }

		function register(){
	     
	      var xmlhttp = new XMLHttpRequest();
	      xmlhttp.open("POST", "/register", true);
	      xmlhttp.send('user='+user +'&pin='+pin);

	      setTimeout(function(){
	      	setUser()
			document.getElementById('finished').innerHTML = '<div class="row">'
			document.getElementById('finished').innerHTML += '<div class="col-sm-4"></div>'
			document.getElementById('finished').innerHTML += '<div class="col-sm-4">'
			document.getElementById('finished').innerHTML += '<Center><h2>Thank you for registering!</h2></Center>'
			document.getElementById('finished').innerHTML += '</div>'
			document.getElementById('finished').innerHTML += '<div class="col-sm-4"></div>'
			document.getElementById('finished').innerHTML += '</div>'
			document.getElementById('finished').innerHTML += '<br>'

			document.getElementById('finished').innerHTML += '<div class="row">'
			document.getElementById('finished').innerHTML += '<div class="col-sm-4"></div>'
			document.getElementById('finished').innerHTML += '<div class="col-sm-2"><button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#alertModal">Take an Exam!</button></div>'
			document.getElementById('finished').innerHTML += '<div class="col-sm-2"><button type="button" class="btn btn-primary" onclick="profile()">Visit Profile</button></div>'
			document.getElementById('finished').innerHTML += '<div class="col-sm-4"></div>'
			document.getElementById('finished').innerHTML += '</div>'
			document.getElementById('finished').innerHTML += '<br>'
			document.getElementById('finished').innerHTML += '<br>'
			document.getElementById('finished').innerHTML += '<br>'
	      }, 1000)
	    }

	    function setUser() {

	      function reqListener () {
	      }

	      var oReq = new XMLHttpRequest();

	      oReq.addEventListener("load", reqListener);
	      oReq.open("POST", "/setUser", true);
	      oReq.send('username='+user);

	    }

	    function profile(){
	    	window.location.href = "profiles.html"
	    }

	    function exam1() {
	        window.location.href = "examFundamentals.html";
	      }

	      function exam2() {
	        window.location.href = "examSkills.html";
	      }

	      function exam3() {
	        window.location.href = "examSkillsM.html";
	      }

	      function exam4() {
	        window.location.href = "examSkillsD.html";
	      }



	</script>



</html>